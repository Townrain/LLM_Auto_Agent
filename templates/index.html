<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Auto Agent - 智能助手</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>LLM Auto Agent</h2>
                <button class="btn-new-chat" id="newChatBtn">
                    <span>+ 新对话</span>
                </button>
            </div>
            
            <div class="chat-history" id="chatHistory">
                <div class="current-chat-title">新对话</div>
                <div class="chat-list" id="chatList">
                    <!-- 对话历史将在这里动态生成 -->
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="btn-settings" id="settingsBtn">
                    <span>⚙️ 设置</span>
                </button>
                <button class="btn-import" id="importBtn">
                    <span>📚 导入知识库</span>
                </button>
            </div>
        </div>

        <!-- 主聊天区域 -->
        <div class="main-content">
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <!-- 欢迎消息 -->
                    <div class="message system-message">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <h3>欢迎使用 LLM Auto Agent</h3>
                            <p>我是一个基于ReAct模式的智能助手，可以帮您处理各种任务：</p>
                            <ul>
                                <li>📄 文件操作和文档处理</li>
                                <li>🌐 网页搜索和信息查询</li>
                                <li>💻 代码执行和系统命令</li>
                                <li>🗄️ 数据库管理和知识检索</li>
                            </ul>
                            <p>请先点击左下角的"设置"按钮配置您的API Key。</p>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            id="userInput" 
                            placeholder="输入您的问题... (按Enter发送，Shift+Enter换行)"
                            rows="1"
                        ></textarea>
                        <button id="sendBtn" class="send-button">
                            <span>发送</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>系统设置</h3>
                <span class="close" id="closeSettings">&times;</span>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="apiKey">DeepSeek API Key:</label>
                        <input type="password" id="apiKey" placeholder="输入您的DeepSeek API Key" required>
                        <small>您可以在DeepSeek官网获取API Key</small>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="useDatabase">
                            启用数据库功能
                        </label>
                        <small>启用后可以保存对话历史和用户数据</small>
                    </div>
                    
                    <div id="databaseSettings" class="database-settings" style="display: none;">
                        <div class="form-group">
                            <label for="dbHost">数据库主机:</label>
                            <input type="text" id="dbHost" value="localhost" placeholder="localhost">
                        </div>
                        <div class="form-group">
                            <label for="dbPort">数据库端口:</label>
                            <input type="number" id="dbPort" value="3306" placeholder="3306">
                        </div>
                        <div class="form-group">
                            <label for="dbUser">数据库用户:</label>
                            <input type="text" id="dbUser" value="root" placeholder="root">
                        </div>
                        <div class="form-group">
                            <label for="dbPassword">数据库密码:</label>
                            <input type="password" id="dbPassword" placeholder="输入数据库密码">
                        </div>
                        <div class="form-group">
                            <label for="dbName">数据库名称:</label>
                            <input type="text" id="dbName" value="llm_agent" placeholder="llm_agent">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">保存设置</button>
                        <button type="button" class="btn-secondary" id="cancelSettings">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 导入知识库模态框 -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>导入知识库</h3>
                <span class="close" id="closeImport">&times;</span>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📚</div>
                    <h4>拖放文件到这里或点击选择</h4>
                    <p>支持的文件格式: TXT, PDF, DOC, DOCX, Markdown, JSON</p>
                    <input type="file" id="fileInput" accept=".txt,.pdf,.doc,.docx,.md,.json" style="display: none;">
                    <button type="button" class="btn-primary" onclick="document.getElementById('fileInput').click()">
                        选择文件
                    </button>
                </div>
                <div id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p>上传中...</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancelImport">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 命令确认模态框 -->
    <div id="commandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚠️ 系统命令确认</h3>
                <span class="close" id="closeCommand">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <p><strong>安全警告:</strong> 即将执行以下系统命令：</p>
                    <div class="command-display" id="commandDisplay"></div>
                    <p>请确认您了解此命令的作用和潜在风险。</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-danger" id="confirmCommand">确认执行</button>
                    <button type="button" class="btn-secondary" id="cancelCommand">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
        <div class="loading-spinner"></div>
        <p>AI正在思考中...</p>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>